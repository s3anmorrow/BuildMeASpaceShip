var SpaceShip=function(){function j(e){e.target.active=!1,e.target.graphics.clear(),l.laserBeams.removeChild(e.target),n.toggleTurret(!0)}var e=window.assetManager,n=(window.root,window.randomMe,this),r=stage.canvas.width,s=window.BASE_WIDTH,i=["fuselage","wings","tail","cockpit","laser"],o=new createjs.Container,l={};l.fuselage=new createjs.Container,l.wings=new createjs.Container,l.tail=new createjs.Container,l.cockpit=new createjs.Container,l.laserBeams=new createjs.Container,l.laser=new createjs.Container;for(var c=[],g=0;5>g;g++)c[g]=new createjs.Shape,c[g].active=!1;var d={};d.fuselage=null,d.wings=null,d.tail=null,d.cockpit=null,d.laser=null;var u={};u.fuselage=new createjs.Shape,u.wings=new createjs.Shape,u.tail=new createjs.Shape;var v={};v.fuselage=e.getSprite("assets"),v.wings=e.getSprite("assets"),v.tail=e.getSprite("assets");var h={};h.fuselage1=new createjs.Rectangle(0,0,176,400),h.fuselage2=new createjs.Rectangle(0,0,176,400),h.fuselage3=new createjs.Rectangle(0,0,176,400),h.fuselage4=new createjs.Rectangle(0,0,176,400),h.fuselage5=new createjs.Rectangle(0,0,176,400),h.wings1=new createjs.Rectangle(-74,209,320,95),h.wings2=new createjs.Rectangle(-84,215,340,80),h.wings3=new createjs.Rectangle(-84,205,340,100),h.wings4=new createjs.Rectangle(-68,205,317,100),h.wings5=new createjs.Rectangle(-84,215,340,85),h.tail1=new createjs.Rectangle(-2,348,180,64),h.tail2=new createjs.Rectangle(1,359,174,90),h.tail3=new createjs.Rectangle(-6,352,185,94),h.tail4=new createjs.Rectangle(-12,342,199,107),h.tail5=new createjs.Rectangle(-22,370,220,60);var p={};p.laser1=new createjs.Point(88,30),p.laser2=new createjs.Point(88,257),p.laser3=new createjs.Point(88,357),o.addChild(l.wings),o.addChild(l.fuselage),o.addChild(l.tail),o.addChild(l.cockpit),o.addChild(l.laserBeams),o.addChild(l.laser);var S=e.getSprite("assets","laserTurret"),f=e.getSprite("assets","thrust"),w=e.getSprite("assets","smoke"),b=36;this.getShipContainer=function(){return o},this.getColorCanvas=function(e){return u[e]},this.getCockpitLocation=function(){return l.cockpit.localToGlobal(0,d.cockpit.getBounds().height).y},this.showMeOn=function(e,t,a){o.x=t,o.y=a,e.addChild(o)},this.moveMe=function(e){e=e/r*s,e-=92;var t=o.x-e;t>-6&&6>t||(o.x<e?o.x+=6:o.x-=6)},this.focusOnPart=function(e){for(var t=0;5>t;t++)d[i[t]].alpha=.2,3>t&&(u[i[t]].alpha=.2);d[e].alpha=1,u[e].alpha=1},this.unFocusOnParts=function(){for(var e=0;5>e;e++)d[i[e]].alpha=1,3>e&&(u[i[e]].alpha=1)},this.toggleTurret=function(e){e?createjs.Tween.get(S,{loop:!0}).to({rotation:S.rotation+360},17e3):createjs.Tween.removeTweens(S)},this.toggleThrust=function(e){return e?(f.x=18,f.y=d.tail.getBounds().y+d.tail.getBounds().height,f.play(),void o.addChild(f)):(f.stop(),void o.removeChild(f))},this.toggleSmoke=function(e){return e?(w.x=-8,w.y=d.tail.getBounds().y+d.tail.getBounds().height-60,w.play(),void o.addChild(w)):void w.on("animationend",function(){w.stop(),o.removeChild(w)},null,!0)},this.toggleCockpit=function(e){var t=d.cockpit;void 0===t.openFrame&&(t.openFrame=t.currentAnimation,t.closeFrame=t.currentAnimation+"Close"),t.gotoAndPlay(e?t.openFrame:t.closeFrame),t.on("animationend",function(e){e.target.stop()},null,!0)},this.fireMe=function(e,t){var a=t.localToLocal(e.x,e.y,o);this.toggleTurret(!1);var n=Math.atan2(a.y-S.y,a.x-S.x);n*=180/Math.PI,S.rotation=n;for(var r=null,s=0;5>s;s++)if(!c[s].active){r=c[s],r.alpha=1,r.active=!0,l.laserBeams.addChild(r);break}r.graphics.setStrokeStyle(10,"round"),r.graphics.beginStroke("rgba(255,0,0,0.4)"),r.graphics.moveTo(S.x,S.y),r.graphics.lineTo(a.x,a.y),r.graphics.endStroke(),r.graphics.setStrokeStyle(4,"round"),r.graphics.beginStroke("rgba(255,0,0,0.8)"),r.graphics.moveTo(S.x,S.y),r.graphics.lineTo(a.x,a.y),r.graphics.endStroke(),createjs.Tween.get(r).to({alpha:0},300).call(j)},this.flyOffStage=function(t){void 0!=t?createjs.Tween.get(o).to({y:-(o.getBounds().height+10)},1500,createjs.Ease.cubicIn).call(t):createjs.Tween.get(o).to({y:-(o.getBounds().height+10)},1500,createjs.Ease.cubicIn),e.getSound("thrust").play()},this.flyOnStage=function(t){void 0!=t?createjs.Tween.get(o).to({y:400},1500,createjs.Ease.cubicOut).call(t):createjs.Tween.get(o).to({y:400},1500,createjs.Ease.cubicOut),e.getSound("thrust").play()},this.scorchMe=function(t,a){var n=a.localToLocal(t.x,t.y,o);if(!(n.y<0||n.y>420||n.x<-74||n.x>250)){t.soundPlayed||(e.getSound("burn").play(),t.soundPlayed=!0);var r=u.fuselage;r.graphics.beginFill("rgba(0,0,0,0.5)"),r.graphics.drawCircle(n.x,n.y,b),r.graphics.beginFill("rgba(0,0,0,1)"),r.graphics.drawCircle(n.x,n.y,b-6);var s=u.wings;s.graphics.beginFill("rgba(0,0,0,0.5)"),s.graphics.drawCircle(n.x,n.y,b),s.graphics.beginFill("rgba(0,0,0,1)"),s.graphics.drawCircle(n.x,n.y,b-6);var i=u.tail;i.graphics.beginFill("rgba(0,0,0,0.5)"),i.graphics.drawCircle(n.x,n.y,b),i.graphics.beginFill("rgba(0,0,0,1)"),i.graphics.drawCircle(n.x,n.y,b-6);var l=e.getSprite("assets","scorchSmoke");l.x=n.x,l.y=n.y,l.on("animationend",function(e){e.target.stop(),o.removeChild(e.target)},null,!0),l.play(),o.addChild(l),r.updateCache("source-overlay"),r.graphics.clear(),s.updateCache("source-overlay"),s.graphics.clear(),i.updateCache("source-overlay"),i.graphics.clear()}},this.assembleMe=function(e){var t=e.type,a=e.currentAnimation,n=l[t];if(e.x=0,e.y=0,"laser"===t){d[t]=S;var r=p[a];S.x=r.x,S.y=r.y,S.rotation=270,n.addChild(S)}else d[t]=e,n.addChild(e);if("cockpit"!==t&&"laser"!==t){var s=u[t],i=h[a],o=v[t];n.addChild(s),s.cache(i.x,i.y,i.width,i.height),o.gotoAndStop(a+"Mask"),n.addChild(o)}},this.resetMe=function(){d.fuselage=null,d.wings=null,d.tail=null,d.cockpit=null,d.laser=null,S.rotation=0,laserBeamIndex=0,this.toggleThrust(!1),this.toggleSmoke(!1),this.toggleTurret(!1);for(var e=0;5>e;e++)l[i[e]].removeAllChildren();u.fuselage.graphics.clear(),u.fuselage.uncache(),u.wings.graphics.clear(),u.wings.uncache(),u.tail.graphics.clear(),u.tail.uncache()}};
