var SpaceShip=function(){function C(e){e.target.active=!1,e.target.graphics.clear(),l.laserBeams.removeChild(e.target),n.toggleTurret(!0)}var e=window.assetManager,n=(window.root,window.randomMe,this),r=stage.canvas.width,s=window.BASE_WIDTH,o=["fuselage","wings","tail","cockpit","laser"],i=new createjs.Container,l={};l.fuselage=new createjs.Container,l.wings=new createjs.Container,l.tail=new createjs.Container,l.cockpit=new createjs.Container,l.laserBeams=new createjs.Container,l.laser=new createjs.Container;for(var d=[],c=0;5>c;c++)d[c]=new createjs.Shape,d[c].active=!1;var g={};g.fuselage=null,g.wings=null,g.tail=null,g.cockpit=null,g.laser=null;var u={};u.fuselage=new createjs.Shape,u.wings=new createjs.Shape,u.tail=new createjs.Shape;var v={};v.fuselage=e.getSprite("assets"),v.wings=e.getSprite("assets"),v.tail=e.getSprite("assets");var p={};p.fuselage1=new createjs.Rectangle(0,0,176,400),p.fuselage2=new createjs.Rectangle(0,0,176,400),p.fuselage3=new createjs.Rectangle(0,0,176,400),p.fuselage4=new createjs.Rectangle(0,0,176,400),p.fuselage5=new createjs.Rectangle(0,0,176,400),p.wings1=new createjs.Rectangle(-74,209,320,95),p.wings2=new createjs.Rectangle(-84,215,340,80),p.wings3=new createjs.Rectangle(-84,205,340,100),p.wings4=new createjs.Rectangle(-68,205,317,100),p.wings5=new createjs.Rectangle(-84,215,340,85),p.tail1=new createjs.Rectangle(-2,348,180,64),p.tail2=new createjs.Rectangle(1,359,174,90),p.tail3=new createjs.Rectangle(-6,352,185,94),p.tail4=new createjs.Rectangle(-12,342,199,107),p.tail5=new createjs.Rectangle(-22,370,220,60);var f={};f.laser1=new createjs.Point(88,30),f.laser2=new createjs.Point(88,257),f.laser3=new createjs.Point(88,357),i.addChild(l.wings),i.addChild(l.fuselage),i.addChild(l.tail),i.addChild(l.cockpit),i.addChild(l.laserBeams),i.addChild(l.laser);var h=e.getSprite("assets","laserTurret"),w=e.getSprite("assets","thrust"),S=e.getSprite("assets","smoke"),b=36;this.getShipContainer=function(){return i},this.getColorCanvas=function(e){return u[e]},this.getCockpitLocation=function(){return l.cockpit.localToGlobal(0,g.cockpit.getBounds().height).y},this.showMeOn=function(e,t,a){i.x=t,i.y=a,e.addChild(i)},this.moveMe=function(e){e=e/r*s,e-=92;var t=i.x-e;t>-6&&6>t||(i.x<e?i.x+=6:i.x-=6)},this.focusOnPart=function(e){for(var t=0;5>t;t++)g[o[t]].alpha=.2,3>t&&(u[o[t]].alpha=.2);g[e].alpha=1,u[e].alpha=1},this.unFocusOnParts=function(){for(var e=0;5>e;e++)g[o[e]].alpha=1,3>e&&(u[o[e]].alpha=1)},this.toggleTurret=function(e){e?createjs.Tween.get(h,{loop:!0}).to({rotation:h.rotation+360},17e3):createjs.Tween.removeTweens(h)},this.toggleThrust=function(e){return e?(w.x=18,w.y=g.tail.getBounds().y+g.tail.getBounds().height,w.play(),void i.addChild(w)):(w.stop(),void i.removeChild(w))},this.toggleSmoke=function(e){return e?(S.x=-8,S.y=g.tail.getBounds().y+g.tail.getBounds().height-60,S.play(),void i.addChild(S)):void S.on("animationend",function(){S.stop(),i.removeChild(S)},null,!0)},this.toggleCockpit=function(e){var t=g.cockpit;void 0===t.openFrame&&(t.openFrame=t.currentAnimation,t.closeFrame=t.currentAnimation+"Close"),t.gotoAndPlay(e?t.openFrame:t.closeFrame),t.on("animationend",function(e){e.target.stop()},null,!0)},this.fireMe=function(e,t){var a=t.localToLocal(e.x,e.y,i);this.toggleTurret(!1);var n=Math.atan2(a.y-h.y,a.x-h.x);n*=180/Math.PI,h.rotation=n;for(var r=null,s=0;5>s;s++)if(!d[s].active){r=d[s],r.alpha=1,r.active=!0,l.laserBeams.addChild(r);break}r.graphics.setStrokeStyle(10,"round"),r.graphics.beginStroke("rgba(255,0,0,0.4)"),r.graphics.moveTo(h.x,h.y),r.graphics.lineTo(a.x,a.y),r.graphics.endStroke(),r.graphics.setStrokeStyle(4,"round"),r.graphics.beginStroke("rgba(255,0,0,0.8)"),r.graphics.moveTo(h.x,h.y),r.graphics.lineTo(a.x,a.y),r.graphics.endStroke(),createjs.Tween.get(r).to({alpha:0},300).call(C)},this.flyOffStage=function(t){void 0!=t?createjs.Tween.get(i).to({y:-(i.getBounds().height+10)},1500,createjs.Ease.cubicIn).call(t):createjs.Tween.get(i).to({y:-(i.getBounds().height+10)},1500,createjs.Ease.cubicIn),e.getSound("thrust").play()},this.flyOnStage=function(t){void 0!=t?createjs.Tween.get(i).to({y:400},1500,createjs.Ease.cubicOut).call(t):createjs.Tween.get(i).to({y:400},1500,createjs.Ease.cubicOut),e.getSound("thrust").play()},this.scorchMe=function(t,a){var n=a.localToLocal(t.x,t.y,i);if(!(n.y<0||n.y>420||n.x<-74||n.x>250)){t.soundPlayed||(e.getSound("burn").play(),t.soundPlayed=!0);var r=u.fuselage;r.graphics.beginFill("rgba(0,0,0,0.5)"),r.graphics.drawCircle(n.x,n.y,b),r.graphics.beginFill("rgba(0,0,0,1)"),r.graphics.drawCircle(n.x,n.y,b-6);var s=u.wings;s.graphics.beginFill("rgba(0,0,0,0.5)"),s.graphics.drawCircle(n.x,n.y,b),s.graphics.beginFill("rgba(0,0,0,1)"),s.graphics.drawCircle(n.x,n.y,b-6);var o=u.tail;o.graphics.beginFill("rgba(0,0,0,0.5)"),o.graphics.drawCircle(n.x,n.y,b),o.graphics.beginFill("rgba(0,0,0,1)"),o.graphics.drawCircle(n.x,n.y,b-6);var l=e.getSprite("assets","scorchSmoke");l.x=n.x,l.y=n.y,l.on("animationend",function(e){e.target.stop(),i.removeChild(e.target)},null,!0),l.play(),i.addChild(l),r.updateCache("source-overlay"),r.graphics.clear(),s.updateCache("source-overlay"),s.graphics.clear(),o.updateCache("source-overlay"),o.graphics.clear()}},this.assembleMe=function(e){var t=e.type,a=e.currentAnimation,n=l[t];if(e.x=0,e.y=0,"laser"===t){g[t]=h;var r=f[a];h.x=r.x,h.y=r.y,h.rotation=270,n.addChild(h)}else g[t]=e,n.addChild(e);if("cockpit"!==t&&"laser"!==t){var s=u[t],o=p[a],i=v[t];n.addChild(s),s.cache(o.x,o.y,o.width,o.height),i.gotoAndStop(a+"Mask"),n.addChild(i)}},this.resetMe=function(){g.fuselage=null,g.wings=null,g.tail=null,g.cockpit=null,g.laser=null,h.rotation=0,laserBeamIndex=0,this.toggleThrust(!1),this.toggleSmoke(!1),this.toggleTurret(!1);for(var e=0;5>e;e++)l[o[e]].removeAllChildren();u.fuselage.graphics.clear(),u.fuselage.uncache(),u.wings.graphics.clear(),u.wings.uncache(),u.tail.graphics.clear(),u.tail.uncache()}};